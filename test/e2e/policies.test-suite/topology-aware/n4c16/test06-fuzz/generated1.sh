echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1bu0 container-exit0 t1bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t1bu0 kubectl delete pod t1bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 container-exit0 t1gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 kubectl delete pod t1gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 kubectl delete pod t1rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1bu0 kubectl delete pod t1bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1bu0 container-exit0 t1bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1bu0 kubectl delete pod t1bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1bu0 container-exit0 t1bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1bu0 container-exit0 t1bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1bu0 container-exit0 t1bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 kubectl delete pod t1gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu4 kubectl delete pod t1gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1bu0 container-exit0 t1bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1bu0 container-exit0 t1bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t1bu0 container-exit0 t1bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1bu0 container-exit0 t1bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1bu0 kubectl delete pod t1bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1bu0 container-exit0 t1bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1bu0 kubectl delete pod t1bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1bu0 kubectl delete pod t1bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t1bu0 container-exit0 t1bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1bu0 container-exit0 t1bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1bu0 container-exit0 t1bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1bu0 kubectl delete pod t1bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1bu0 container-exit0 t1bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1bu0 container-exit0 t1bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1bu0 container-exit0 t1bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1bu0 kubectl delete pod t1bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4000"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3100"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 kubectl delete pod t1rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu4 container-exit0 t1gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu4 container-exit0 t1gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu4 container-exit0 t1gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu4 container-exit0 t1gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu4 container-exit0 t1gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu4 container-exit0 t1gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu4 kubectl delete pod t1gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t1bu0 kubectl delete pod t1bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1bu0 kubectl delete pod t1bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 container-exit0 t1gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu4 container-exit0 t1gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 kubectl delete pod t1gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu4 kubectl delete pod t1gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1bu0 kubectl delete pod t1bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 1100"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu4 kubectl delete pod t1gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1bu0 kubectl delete pod t1bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1bu0 container-exit0 t1bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu4 kubectl delete pod t1gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1bu0 container-exit0 t1bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1bu0 kubectl delete pod t1bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2650"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2650"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2650"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2650"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2650"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2650"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2650"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1bu0 kubectl delete pod t1bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2600"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2600"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2600"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2650"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1rbu0 kubectl delete pod t1rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 container-exit0 t1gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 container-exit0 t1gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 kubectl delete pod t1gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1rbu0 kubectl delete pod t1rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t1bu0 container-exit0 t1bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t1bu0 kubectl delete pod t1bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1bu0 container-exit0 t1bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1bu0 kubectl delete pod t1bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t1bu0 kubectl delete pod t1bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1rbu0 kubectl delete pod t1rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 container-exit0 t1gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 kubectl delete pod t1gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 kubectl delete pod t1gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1150"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1150"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1150"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1150"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1150"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1rbu0 kubectl delete pod t1rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1bu0 container-exit0 t1bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1bu0 kubectl delete pod t1bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 container-exit0 t1gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 container-exit0 t1gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 kubectl delete pod t1rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu4 kubectl delete pod t1gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 kubectl delete pod t1gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 kubectl delete pod t1gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 kubectl delete pod t1rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 kubectl delete pod t1gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1rbu0 kubectl delete pod t1rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t1bu0 kubectl delete pod t1bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1700"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1700"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1rbu0 kubectl delete pod t1rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu4 container-exit0 t1gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu4 kubectl delete pod t1gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 container-exit0 t1gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 kubectl delete pod t1gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1rbu0 kubectl delete pod t1rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 kubectl delete pod t1gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1bu0 kubectl delete pod t1bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1rbu0 kubectl delete pod t1rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 container-exit0 t1gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 kubectl delete pod t1gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 kubectl delete pod t1rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1rbu0 kubectl delete pod t1rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1bu0 kubectl delete pod t1bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1rbu0 kubectl delete pod t1rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 kubectl delete pod t1rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 kubectl delete pod t1rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 kubectl delete pod t1rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 kubectl delete pod t1rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1bu0 kubectl delete pod t1bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 kubectl delete pod t1rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 kubectl delete pod t1gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1rbu0 kubectl delete pod t1rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1bu0 kubectl delete pod t1bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1bu0 kubectl delete pod t1bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu4 container-exit0 t1gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t1gu4 container-exit0 t1gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 kubectl delete pod t1gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1bu0 kubectl delete pod t1bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 kubectl delete pod t1rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 kubectl delete pod t1rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 container-exit0 t1gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 kubectl delete pod t1gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1700"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1700"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 container-exit0 t1bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 container-exit0 t1gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1gu4 container-exit0 t1gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1be0 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1gu1 container-exit0 t1gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t1gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 container-exit0 t1rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t1rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t1rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbu0 kubectl delete pod t1rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1be1 container-exit0 t1be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected:   't1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1be0 kubectl delete pod t1be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t1bu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t1bu1 kubectl delete pod t1bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t1gu1 kubectl delete pod t1gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1bu0 container-exit0 t1bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1rbe0 container-exit0 t1rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1bu0 container-exit0 t1bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1rbe0 kubectl delete pod t1rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1bu0 container-exit0 t1bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t1gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1bu0 container-exit0 t1bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t1gu0 kubectl delete pod t1gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t1be1,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t1be1 kubectl delete pod t1be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t1bu0,namespace:default}"
echo "expected:   't1gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t1gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected:   't1rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t1rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t1gu0 container-exit0 t1gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t1gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
( kubectl delete pods t1rgu0 t1rbu0 t1rbe0 -n kube-system --now ) ; ( kubectl delete pods t1gu0 t1gu1 t1gu2 t1gu3 t1gu4 t1bu0 t1bu1 t1be0 t1be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t1be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t1be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t1be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t1gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
