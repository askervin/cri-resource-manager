echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0gu1 kubectl delete pod t0gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu1 container-exit0 t0bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0bu1 kubectl delete pod t0bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu4 container-exit0 t0gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 kubectl delete pod t0rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 kubectl delete pod t0gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 kubectl delete pod t0gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 kubectl delete pod t0gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0bu1 container-exit0 t0bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0bu1 kubectl delete pod t0bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 kubectl delete pod t0gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 kubectl delete pod t0gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 kubectl delete pod t0gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 kubectl delete pod t0gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0bu1 container-exit0 t0bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0bu1 kubectl delete pod t0bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0bu1 container-exit0 t0bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0bu1 container-exit0 t0bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu1 container-exit0 t0bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0bu1 container-exit0 t0bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0bu1 kubectl delete pod t0bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 kubectl delete pod t0gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0gu1 kubectl delete pod t0gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t0bu1 container-exit0 t0bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0bu1 container-exit0 t0bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 kubectl delete pod t0gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t0bu1 kubectl delete pod t0bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 container-exit0 t0gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 container-exit0 t0gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 container-exit0 t0gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 container-exit0 t0gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 container-exit0 t0gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 container-exit0 t0gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 container-exit0 t0gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu4 container-exit0 t0gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0rbu0 kubectl delete pod t0rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2200"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 container-exit0 t0gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 container-exit0 t0gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3100"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu1 container-exit0 t0bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu1 container-exit0 t0bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu1 kubectl delete pod t0bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu1 container-exit0 t0bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu1 container-exit0 t0bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0bu1 kubectl delete pod t0bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0bu1 kubectl delete pod t0bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0bu1 kubectl delete pod t0bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu4 container-exit0 t0gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu1 kubectl delete pod t0bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu1 kubectl delete pod t0bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0gu1 kubectl delete pod t0gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2600"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2600"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2600"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2600"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2650"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2650"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2650"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2650"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2650"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2650"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1150"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1150"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1150"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1150"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1150"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1150"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1150"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1150"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1150"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1150"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2650"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2650"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2650"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2650"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0rbu0 kubectl delete pod t0rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0gu1 kubectl delete pod t0gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0gu1 kubectl delete pod t0gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0rbu0 kubectl delete pod t0rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0gu1 kubectl delete pod t0gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0bu1 container-exit0 t0bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu4 container-exit0 t0gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 kubectl delete pod t0rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu4 container-exit0 t0gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0rbu0 kubectl delete pod t0rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 250"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu1 kubectl delete pod t0bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1150"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2650"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1150"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0rbu0 kubectl delete pod t0rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0gu1 kubectl delete pod t0gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0gu1 kubectl delete pod t0gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu4 container-exit0 t0gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu1 kubectl delete pod t0bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0bu1 container-exit0 t0bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0bu1 container-exit0 t0bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 kubectl delete pod t0rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 kubectl delete pod t0rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t0bu1 container-exit0 t0bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t0bu1 kubectl delete pod t0bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 container-exit0 t0gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0gu1 kubectl delete pod t0gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0bu1 kubectl delete pod t0bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu1 kubectl delete pod t0bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0rbu0 kubectl delete pod t0rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu4 container-exit0 t0gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1700"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1700"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0rbu0 kubectl delete pod t0rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0gu1 kubectl delete pod t0gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t0bu1 kubectl delete pod t0bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1700"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0rbu0 kubectl delete pod t0rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 container-exit0 t0gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 kubectl delete pod t0rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0rbu0 kubectl delete pod t0rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0bu1 kubectl delete pod t0bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 kubectl delete pod t0rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu4 container-exit0 t0gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0rbu0 kubectl delete pod t0rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0bu1 container-exit0 t0bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu1 kubectl delete pod t0bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1700"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1700"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1700"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1700"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t0rbu0 kubectl delete pod t0rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t0bu1 container-exit0 t0bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0bu1 container-exit0 t0bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0bu1 kubectl delete pod t0bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0bu1 container-exit0 t0bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1700"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1700"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1700"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1700"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0bu1 container-exit0 t0bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0bu1 container-exit0 t0bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0rbu0 kubectl delete pod t0rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 250"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 250"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 250"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu1 container-exit0 t0bu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 250"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 250"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 250"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 200"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0bu1 kubectl delete pod t0bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 kubectl delete pod t0rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0gu1 kubectl delete pod t0gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 kubectl delete pod t0rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 kubectl delete pod t0gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0gu1 kubectl delete pod t0gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu4 container-exit0 t0gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 kubectl delete pod t0rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0gu1 kubectl delete pod t0gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0rbu0 kubectl delete pod t0rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 container-exit0 t0rbu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 container-exit0 t0gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 kubectl delete pod t0rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0bu1 kubectl delete pod t0bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 kubectl delete pod t0rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbu0 kubectl delete pod t0rbu0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3800"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4400"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 container-exit0 t0rbe0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu4 kubectl delete pod t0gu4 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0gu4 CONTCOUNT=1 CPU=4200m MEM=100M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
NAME=t0gu4 container-exit0 t0gu4c; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu4': {CONTCOUNT:1,CPU:4200,MEM:100,NAME:t0gu4,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4200"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbe0 CONTCOUNT=2 CPU=0 MEM=0 namespace=kube-system create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0rbe0': {CONTCOUNT:2,CPU:0,MEM:0,NAME:t0rbe0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0rbe0 kubectl delete pod t0rbe0 -n kube-system --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0gu1 container-exit0 t0gu1c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 200"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu1 kubectl delete pod t0bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0gu1 kubectl delete pod t0gu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0be0 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1000"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2000"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2500"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2200"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0gu0 container-exit0 t0gu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 2550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 3100"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0bu0 container-exit0 t0bu0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0gu0 CONTCOUNT=1 CPU=200m MEM=1500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be0': {CONTCOUNT:1,CPU:0,MEM:0,NAME:t0be0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0be0 kubectl delete pod t0be0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1550"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 1100"
NAME=t0bu1 CONTCOUNT=2 CPU=1900m MEM=50M CPUREQ=1900m MEMREQ=50M CPULIM=4000m MEMLIM=1000M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0bu0 kubectl delete pod t0bu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1600"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4000"
NAME=t0bu0 CONTCOUNT=1 CPU=900m MEM=50M CPUREQ=900m MEMREQ=50M CPULIM=1200m MEMLIM=100M create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1650"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0gu0': {CONTCOUNT:1,CPU:200,MEM:1500,NAME:t0gu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4900"
NAME=t0gu0 kubectl delete pod t0gu0 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0be1 container-exit0 t0be0c0; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0be1 kubectl delete pod t0be1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 150"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0bu1': {CONTCOUNT:2,CPU:1900,CPULIM:4000,CPUREQ:1900,MEM:50,MEMLIM:1000,MEMREQ:50,NAME:t0bu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 4700"
NAME=t0bu1 kubectl delete pod t0bu1 --now; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 50"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected: }"
echo "expected: cpu = 900"
NAME=t0gu1 CONTCOUNT=2 CPU=1000m MEM=500M create guaranteed; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
NAME=t0be1 CONTCOUNT=3 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 1050"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {'t0bu0': {CONTCOUNT:1,CPU:900,CPULIM:1200,CPUREQ:900,MEM:50,MEMLIM:100,MEMREQ:50,NAME:t0bu0,namespace:default}"
echo "expected:   't0be1': {CONTCOUNT:3,CPU:0,MEM:0,NAME:t0be1,namespace:default}"
echo "expected:   't0gu1': {CONTCOUNT:2,CPU:1000,MEM:500,NAME:t0gu1,namespace:default}"
echo "expected: }"
echo "expected: cpu = 2900"
( kubectl delete pods t0rgu0 t0rbu0 t0rbe0 -n kube-system --now ) ; ( kubectl delete pods t0gu0 t0gu1 t0gu2 t0gu3 t0gu4 t0bu0 t0bu1 t0be0 t0be1 --now ); kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 0"
echo "expected: reserved_cpu = 0"
echo "expected: pods = {}"
echo "expected: cpu = 0"
NAME=t0rbu0 CONTCOUNT=1 CPU=200m MEM=100M CPUREQ=200m MEMREQ=100M CPULIM=2500m MEMLIM=2500M namespace=kube-system create burstable; kubectl get pods -A; vm-command "date +%T.%N"
echo "expected: mem = 100"
echo "expected: reserved_cpu = 200"
echo "expected: pods = {'t0rbu0': {CONTCOUNT:1,CPU:200,CPULIM:2500,CPUREQ:200,MEM:100,MEMLIM:2500,MEMREQ:100,NAME:t0rbu0,namespace:kube-system}"
echo "expected: }"
echo "expected: cpu = 0"
NAME=t0be0 CONTCOUNT=1 CPU=0 MEM=0 create besteffort; kubectl get pods -A; vm-command "date +%T.%N"
